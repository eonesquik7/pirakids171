<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gerador e Verificador de Cartões</title>
<style>
  body {
    background-color: #000;
    color: #fff;
    font-family: monospace, monospace;
    margin: 0; padding: 20px;
    user-select: none;
  }
  h1 {
    text-align: center;
    color: red;
    cursor: pointer;
    user-select: none;
  }
  #container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  #generator, #verifier {
    background: #111;
    border: 1px solid #555;
    border-radius: 6px;
    padding: 15px;
    flex: 1 1 400px;
    min-width: 350px;
  }
  label {
    display: block;
    margin: 10px 0 5px;
  }
  select, input[type=number], input[type=text], textarea {
    width: 100%;
    background: #222;
    border: 1px solid #444;
    color: #fff;
    font-family: monospace;
    font-size: 1rem;
    padding: 8px;
    border-radius: 4px;
  }
  textarea {
    resize: vertical;
    min-height: 150px;
    font-size: 0.9rem;
  }
  button {
    margin-top: 10px;
    padding: 10px;
    width: 100%;
    background: red;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border-radius: 5px;
  }
  button:hover {
    background: #cc0000;
  }
  #single-check-result {
    margin-top: 10px;
    white-space: pre-wrap;
    background: #222;
    padding: 10px;
    border-radius: 4px;
    min-height: 90px;
  }
  #single-card-image {
    margin-top: 8px;
    font-size: 1.4rem;
  }
  #mass-check-output {
    margin-top: 10px;
    white-space: pre-wrap;
    background: #222;
    padding: 10px;
    border-radius: 4px;
    min-height: 150px;
    font-size: 0.85rem;
    overflow-y: auto;
  }
</style>
</head>
<body>

<h1 id="title">Pirakids</h1>

<div id="container">

  <section id="generator">
    <h2>Gerador de Cartões</h2>
    <label for="card-quantity">Quantidade (1 a 100):</label>
    <input type="number" id="card-quantity" min="1" max="100" value="10" />

    <label for="card-brand">Bandeira:</label>
    <select id="card-brand">
      <option value="random">Aleatório</option>
      <option value="visa">Visa</option>
      <option value="mastercard">Mastercard</option>
      <option value="amex">American Express</option>
      <option value="discover">Discover</option>
      <option value="elo">Elo</option>
      <option value="diners">Diners Club</option>
      <option value="jcb">JCB</option>
    </select>

    <button id="btn-generate">Gerar</button>

    <label for="gen-output">Cartões gerados (Número|Validade|CVV):</label>
    <textarea id="gen-output" readonly></textarea>
  </section>

  <section id="verifier">
    <h2>Verificador de Cartões</h2>

    <div style="display:flex; gap:15px; flex-wrap: wrap;">

      <div style="flex:1; min-width: 180px;">
        <h3>Verificação Única</h3>
        <label for="single-number">Número do Cartão:</label>
        <input type="text" id="single-number" placeholder="Apenas números" maxlength="19" />

        <label for="single-validity">Validade (MM/AA):</label>
        <input type="text" id="single-validity" placeholder="MM/AA" maxlength="5" />

        <label for="single-cvv">CVV:</label>
        <input type="text" id="single-cvv" placeholder="3 dígitos" maxlength="3" />

        <button id="btn-single-check">Verificar Único</button>

        <pre id="single-check-result"></pre>
        <div id="single-card-image"></div>
      </div>

      <div style="flex:1.5; min-width: 250px;">
        <h3>Verificação em Massa</h3>
        <label for="mass-input">Cole os cartões (Número|MM/AA|CVV) por linha:</label>
        <textarea id="mass-input" placeholder="Exemplo: 4111111111111111|12/25|123"></textarea>
        <button id="btn-mass-check">Verificar em Massa</button>
        <pre id="mass-check-output"></pre>
      </div>

    </div>
  </section>

</div>

<script>
  // Função para gerar números aleatórios entre min e max (inteiros)
  function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // Geração validade MM/AA (anos próximos)
  function generateValidity() {
    const month = randomInt(1,12).toString().padStart(2,'0');
    const year = randomInt(23,28).toString();
    return `${month}/${year}`;
  }

  // Gerar CVV 3 dígitos
  function generateCVV(length = 3) {
    let cvv = '';
    for(let i=0; i<length; i++) {
      cvv += randomInt(0,9).toString();
    }
    return cvv;
  }

  // Luhn digit calculation
  function calculateLuhnDigit(number) {
    const digits = number.split('').map(d => parseInt(d));
    let sum = 0;
    for (let i = digits.length - 1, j=0; i >= 0; i--, j++) {
      let digit = digits[i];
      if (j % 2 === 0) {
        digit *= 2;
        if (digit > 9) digit -= 9;
      }
      sum += digit;
    }
    const mod = sum % 10;
    return (mod === 0) ? 0 : (10 - mod);
  }

  // Função que valida o número pelo algoritmo de Luhn
  function isValidLuhn(num) {
    let sum = 0;
    let alt = false;
    for(let i = num.length - 1; i >= 0; i--) {
      let digit = parseInt(num.charAt(i));
      if (alt) {
        digit *= 2;
        if(digit > 9) digit -= 9;
      }
      sum += digit;
      alt = !alt;
    }
    return sum % 10 === 0;
  }

  // Bandeiras e seus prefixos + tamanhos e cvv
  // Cada objeto: prefixos[], tamanho total do número, tamanho cvv, nome para mostrar
  const cardBrands = {
    visa:       {prefixes: ['4'], length: 16, cvv: 3, name: 'Visa'},
    mastercard: {prefixes: ['51','52','53','54','55'], length: 16, cvv: 3, name: 'Mastercard'},
    amex:       {prefixes: ['34','37'], length: 15, cvv: 4, name: 'American Express'},
    discover:   {prefixes: ['6011','65','644','645','646','647','648','649'], length: 16, cvv: 3, name: 'Discover'},
    elo:        {prefixes: ['40117','431274','438935','504175','636297'], length: 16, cvv: 3, name: 'Elo'},
    diners:     {prefixes: ['300','301','302','303','304','305','36','38'], length: 14, cvv: 3, name: 'Diners Club'},
    jcb:        {prefixes: ['3528','3589'], length: 16, cvv: 3, name: 'JCB'}
  };

  // Função para gerar número válido para uma bandeira
  function generateCardNumber(brandKey) {
    let brand = cardBrands[brandKey];
    if (!brand) {
      // Se for "random" ou inválido, escolhe aleatoriamente uma bandeira válida
      const keys = Object.keys(cardBrands);
      brandKey = keys[randomInt(0, keys.length - 1)];
      brand = cardBrands[brandKey];
    }

    // Escolhe prefixo aleatório da lista
    const prefix = brand.prefixes[randomInt(0, brand.prefixes.length - 1)];
    // Começa com o prefixo
    let number = prefix;

    // Completa com números aleatórios até length - 1
    while (number.length < brand.length - 1) {
      number += randomInt(0,9);
    }

    // Calcula dígito verificador
    const checkDigit = calculateLuhnDigit(number);
    return {number: number + checkDigit.toString(), brandKey: brandKey};
  }

  // Gerar validade (para Amex, pode manter igual)
  // Gerar CVV com o tamanho correto para cada bandeira
  function generateCard(brandKey) {
    const cardNumData = generateCardNumber(brandKey);
    const validity = generateValidity();
    const cvvLength = cardBrands[cardNumData.brandKey].cvv;
    const cvv = generateCVV(cvvLength);
    return `${cardNumData.number}|${validity}|${cvv}`;
  }

  // Função para identificar bandeira pelo prefixo (para verificação)
  function getBrandByNumber(number) {
    for (const key in cardBrands) {
      for (const prefix of cardBrands[key].prefixes) {
        if (number.startsWith(prefix)) {
          return cardBrands[key].name;
        }
      }
    }
    return 'Desconhecida';
  }

  // Verificar validade do cartão (data)
  function isValidDate(val) {
    if (!val.match(/^(0[1-9]|1[0-2])\/\d{2}$/)) return false;
    const [mm, yy] = val.split('/');
    const currentYear = new Date().getFullYear() % 100;
    const currentMonth = new Date().getMonth() + 1;
    if (parseInt(mm) < 1 || parseInt(mm) > 12) return false;
    if (parseInt(yy) < currentYear) return false;
    if (parseInt(yy) === currentYear && parseInt(mm) < currentMonth) return false;
    return true;
  }

  // EVENTOS

  document.getElementById('btn-generate').addEventListener('click', () => {
    const qtyInput = document.getElementById('card-quantity');
    let qty = parseInt(qtyInput.value);
    if (isNaN(qty) || qty < 1) qty = 1;
    if (qty > 100) qty = 100;

    const brandSelect = document.getElementById('card-brand');
    let brand = brandSelect.value;

    let output = '';
    for(let i=0; i < qty; i++) {
      output += generateCard(brand) + '\n';
    }
    document.getElementById('gen-output').value = output.trim();
  });

  document.getElementById('btn-single-check').addEventListener('click', () => {
    const num = document.getElementById('single-number').value.replace(/\D/g,'');
    const val = document.getElementById('single-validity').value.trim();
    const cvv = document.getElementById('single-cvv').value.trim();

    const resultEl = document.getElementById('single-check-result');
    const imageEl = document.getElementById('single-card-image');

    if (!num || num.length < 13 || num.length > 19) {
      alert('Número do cartão inválido.');
      return;
    }
    if (!val.match(/^(0[1-9]|1[0-2])\/\d{2}$/)) {
      alert('Validade deve estar no formato MM/AA.');
      return;
    }
    if (!cvv.match(/^\d{3,4}$/)) {
      alert('CVV inválido (3 ou 4 dígitos).');
      return;
    }

    const brand = getBrandByNumber(num);
    const validLuhn = isValidLuhn(num);
    const validDate = isValidDate(val);

    let validityMsg = validDate ? 'Validade dentro do prazo.' : 'Validade expirada ou inválida.';

    resultEl.textContent = 
      `Bandeira: ${brand}\n` +
      `Número válido (Luhn): ${validLuhn ? 'Sim' : 'Não'}\n` +
      `Validade: ${validityMsg}\n` +
      `CVV: ${cvv}`;

    if (brand === 'Visa') {
      imageEl.textContent = '💳 Visa';
    } else if (brand === 'Mastercard') {
      imageEl.textContent = '💳 Mastercard';
    } else if (brand === 'American Express') {
      imageEl.textContent = '💳 American Express';
    } else if (brand === 'Discover') {
      imageEl.textContent = '💳 Discover';
    } else if (brand === 'Elo') {
      imageEl.textContent = '💳 Elo';
    } else if (brand === 'Diners Club') {
      imageEl.textContent = '💳 Diners Club';
    } else if (brand === 'JCB') {
      imageEl.textContent = '💳 JCB';
    } else {
      imageEl.textContent = '💳 Bandeira desconhecida';
    }
  });

  document.getElementById('btn-mass-check').addEventListener('click', () => {
    const input = document.getElementById('mass-input').value.trim();
    const output = [];
    if (!input) {
      alert('Cole os cartões para verificar.');
      return;
    }
    const lines = input.split('\n');

    for(let line of lines) {
      line = line.trim();
      if (!line) continue;
      // Espera formato: número|MM/AA|CVV
      const parts = line.split('|').map(p => p.trim());
      if(parts.length !== 3) {
        output.push(`[Inválido] Formato incorreto: ${line}`);
        continue;
      }
      const [num, val, cvv] = parts;
      const numClean = num.replace(/\D/g,'');
      if(numClean.length < 13 || numClean.length > 19) {
        output.push(`[Inválido] Número inválido: ${line}`);
        continue;
      }
      const brand = getBrandByNumber(numClean);
      const validLuhn = isValidLuhn(numClean);
      const validDate = isValidDate(val);
      let validityMsg = validDate ? 'Validade ok' : 'Validade inválida';

      output.push(`${num} | ${val} | ${cvv} -> ${brand} | Luhn: ${validLuhn ? 'Ok' : 'Inválido'} | ${validityMsg}`);
    }
    document.getElementById('mass-check-output').textContent = output.join('\n');
  });

</script>

</body>
</html>
